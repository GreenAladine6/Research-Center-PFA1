<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="Upcoming events at ENSIT Research Center" />
  <meta name="author" content="ENSIT Research Center" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

  <title>ENSIT Research Center - Events</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-chain-app-dev.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animated.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}" />
  <style>
    .d-none {
      display: none !important;
    }

    /* Event Grid Styling */
    #eventsRow {
      margin-top: 30px;
    }

    #eventsRow .col-md-4 {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    #eventsRow .card {
      background: #fff;
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      max-width: 350px;
      width: 100%;
    }

    #eventsRow .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    #eventsRow .event-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-bottom: 3px solid #4b8ef1;
    }

    #eventsRow .event-details {
      padding: 20px;
    }

    #eventsRow .event-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 15px;
      line-height: 1.3;
    }

    #eventsRow .event-meta {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: #666;
    }

    #eventsRow .type-badge {
      background: #4b8ef1;
      color: #fff;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 500;
      margin-right: 10px;
    }

    #eventsRow .user-name {
      font-weight: 500;
      color: #333;
    }

    #eventsRow .event-dates,
    #eventsRow .event-time,
    #eventsRow .event-place {
      display: flex;
      align-items: center;
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 8px;
    }

    #eventsRow .event-dates i,
    #eventsRow .event-time i,
    #eventsRow .event-place i {
      color: #4b8ef1;
      margin-right: 8px;
    }

    #eventsRow .event-dates span,
    #eventsRow .event-time span,
    #eventsRow .event-place span {
      font-weight: 400;
    }

    #eventsRow .btn-primary {
      background: #4b8ef1;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    #eventsRow .btn-primary:hover {
      background: #3a7bd5;
    }

    #moreEventsBtn,
    #lessEventsBtn {
      padding: 12px 30px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 8px;
      margin: 0 10px;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    #moreEventsBtn {
      background: #4b8ef1;
      color: #fff;
      border: none;
    }

    #moreEventsBtn:hover {
      background: #3a7bd5;
      transform: translateY(-2px);
    }

    #lessEventsBtn {
      background: #e0e0e0;
      color: #333;
      border: none;
    }

    #lessEventsBtn:hover:not(:disabled) {
      background: #d0d0d0;
      transform: translateY(-2px);
    }

    #lessEventsBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Filter Styling */
    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group .form-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-group label {
      font-weight: 500;
      margin-bottom: 5px;
      display: block;
    }

    .filter-group select,
    .filter-group input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.95rem;
    }

    /* Modal Styling */
    #eventModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    #eventModal .modal-content {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    #eventModal .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }

    #eventModal h2 {
      color: #4b8ef1;
      margin-top: 0;
      font-size: 1.8rem;
    }

    #eventModal .modal-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    #eventModal .modal-details p {
      margin: 10px 0;
      font-size: 1rem;
      color: #555;
    }

    #eventModal .modal-details strong {
      color: #333;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      #eventsRow .event-image {
        height: 180px;
      }

      #eventsRow .event-title {
        font-size: 1.3rem;
      }

      #eventsRow .card {
        max-width: 100%;
      }

      .filter-group .form-group {
        min-width: 100%;
      }
    }

    @media (max-width: 576px) {
      #eventsRow .event-image {
        height: 160px;
      }

      #eventsRow .event-title {
        font-size: 1.2rem;
      }

      #moreEventsBtn,
      #lessEventsBtn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }

      #eventModal .modal-image {
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- ***** Logo Start ***** -->
            <a href="{{ url_for('fr.index') }}" class="logo">
              <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ENSIT Research Center" />
            </a>
            <!-- ***** Logo End ***** -->
            <!-- ***** Menu Start ***** -->
            <ul class="nav">
              <li class="scroll-to-section"><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.events') }}" class="active">Events</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.project') }}">Project</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.staff') }}">Staff</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.about') }}">About Us</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.contact') }}" class="contact-btn">Contact</a></li>
            </ul>
            <a class="menu-trigger">
              <span>Menu</span>
            </a>
            <!-- ***** Menu End ***** -->
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <main style="padding-top: 150px; padding-bottom: 50px;">
    <h1 class="text-center mb-4">Upcoming Events</h1>
    <div class="container">
      <!-- Filters -->
      <div class="filter-group">
        <div class="form-group">
          <label for="event-input">Search by Title:</label>
          <div class="input-group">
            <span class="input-group-text" style="background-color: white; border-right: none;">
              <i class="fas fa-calendar-alt" style="color: #4b8ef1;"></i>
            </span>
            <input type="text" id="event-input" name="event" placeholder="Enter event title" class="form-control" aria-label="Event input" style="border-left: none;" />
          </div>
        </div>
        <div class="form-group">
          <label for="organizer-filter">Organizer:</label>
          <select id="organizer-filter" class="form-control">
            <option value="">All Organizers</option>
            {% for r in researchers %}
            <option value="{{ r.FULL_NAME }}">{{ r.FULL_NAME }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="type-filter">Event Type:</label>
          <select id="type-filter" class="form-control">
            <option value="">All Types</option>
            {% for type in events | map(attribute='TYPE_EV') | unique %}
            <option value="{{ type }}">{{ type }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="place-filter">Place:</label>
          <select id="place-filter" class="form-control">
            <option value="">All Places</option>
            {% for place in events | map(attribute='PLACE') | reject('none') | unique %}
            <option value="{{ place }}">{{ place }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="date-filter">Start Date:</label>
          <input type="date" id="date-filter" class="form-control" />
        </div>
      </div>

      <!-- Events Grid -->
      <div id="eventsRow" class="row">
        {% if events %}
          {% for event in events %}
          <div class="col-md-4 mb-4 event-card {% if loop.index > 16 %}d-none{% endif %}" 
               data-event-id="{{ loop.index }}"
               data-organizer="{% for r in researchers %}{% if r.id == event.ID_ORGANISOR %}{{ r.FULL_NAME }}{% endif %}{% endfor %}"
               data-type="{{ event.TYPE_EV }}"
               data-place="{{ event.PLACE if event.PLACE else '' }}"
               data-date="{{ event.DATE_BEGIN if event.DATE_BEGIN else '' }}"
               data-description="{{ event.DESCRIPTION if event.DESCRIPTION else 'No description available' }}">
            <div class="card h-100">
              {% set image_path = event.IMAGE.replace('\\', '/') if event.IMAGE else '' %}
              {% set image_path = image_path[7:] if image_path.startswith('static/') else image_path %}
              <img src="{{ url_for('static', filename=image_path) if image_path else url_for('static', filename='images/uploads/events/default-event.jpg') }}" 
                   alt="{{ event.NAME_EVENT }}" class="event-image">
              <div class="event-details">
                <h3 class="event-title">{{ event.NAME_EVENT }}</h3>
                <div class="event-meta">
                  <h3 class="type-badge">{{ event.TYPE_EV }}</h3>
                </div>
                <div class="event-meta">
                  <i class="fas fa-user me-1"></i>
                  <span class="user-name">
                    {% for r in researchers %}
                      {% if r.id == event.ID_ORGANISOR %}
                        {{ r.FULL_NAME }}
                      {% endif %}
                    {% endfor %}
                  </span>
                </div>
                <div class="event-dates">
                  <i class="far fa-calendar-alt me-1"></i>
                  Date: <span>{{ event.DATE_BEGIN if event.DATE_BEGIN else 'N/A' }} - {{ event.DATE_END if event.DATE_END else 'N/A' }}</span>
                </div>
                <div class="event-time">
                  <i class="far fa-clock me-1"></i>
                  Time: <span>{{ event.HOUR if event.HOUR else 'N/A' }}</span>
                </div>
                <div class="event-place">
                  <i class="fas fa-map-marker-alt me-1"></i>
                  Place: <span>{{ event.PLACE if event.PLACE else 'N/A' }}</span>
                </div>
                <button class="btn btn-primary learn-more-btn" 
                        data-title="{{ event.NAME_EVENT }}"
                        data-image="{{ url_for('static', filename=image_path) if image_path else url_for('static', filename='images/uploads/events/default-event.jpg') }}"
                        data-description="{{ event.DESCRIPTION if event.DESCRIPTION else 'No description available' }}"
                        data-organizer="{% for r in researchers %}{% if r.id == event.ID_ORGANISOR %}{{ r.FULL_NAME }}{% endif %}{% endfor %}"
                        data-type="{{ event.TYPE_EV }}"
                        data-dates="{{ event.DATE_BEGIN if event.DATE_BEGIN else 'N/A' }} - {{ event.DATE_END if event.DATE_END else 'N/A' }}"
                        data-time="{{ event.HOUR if event.HOUR else 'N/A' }}"
                        data-place="{{ event.PLACE if event.PLACE else 'N/A' }}">Learn More</button>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="col-12 text-center">
            <p>No upcoming events found.</p>
          </div>
        {% endif %}
        <div class="text-center mt-4">
          <button id="moreEventsBtn" class="btn btn-secondary">More</button>
          <button id="lessEventsBtn" class="btn btn-secondary" disabled>Less</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Event Details Modal -->
  <div id="eventModal">
    <div class="modal-content">
      <span class="modal-close">&times;</span>
      <img id="modal-image" class="modal-image" src="" alt="Event Image">
      <h2 id="modal-title"></h2>
      <div class="modal-details">
        <p><strong>Description:</strong> <span id="modal-description"></span></p>
        <p><strong>Organizer:</strong> <span id="modal-organizer"></span></p>
        <p><strong>Type:</strong> <span id="modal-type"></span></p>
        <p><strong>Dates:</strong> <span id="modal-dates"></span></p>
        <p><strong>Time:</strong> <span id="modal-time"></span></p>
        <p><strong>Place:</strong> <span id="modal-place"></span></p>
      </div>
    </div>
  </div>

  <footer id="contact">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Contact Us</h4>
            <p>ENSIT Beb Alioua, Tunis</p>
            <p><a href="#">123456789</a></p>
            <p><a href="mailto:ensit@research.center">ensit@research.center</a></p>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Us</h4>
            <ul>
              <li><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="{{ url_for('fr.about') }}">About</a></li>
              <li><a href="#">Testimonials</a></li>
              <li><a href="#">Pricing</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Research</a></li>
              <li><a href="{{ url_for('fr.project') }}">Projects</a></li>
              <li><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li><a href="#">News</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Our Center</h4>
            <div class="logo">
              <img src="{{ url_for('static', filename='images/white-logo.png') }}" alt="" />
            </div>
            <p>ENSIT Research Center is dedicated to advancing knowledge and innovation through interdisciplinary research and collaboration.</p>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="copyright-text">
            <p>Copyright © 2023 ENSIT Research Center. All Rights Reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Contact Form Overlay -->
  <div id="form-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
    <div id="contact-form-container" style="background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
      <span class="modal_close" style="position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 20px;">×</span>
      <form id="contact-form" action="{{ url_for('fr.contact') }}" method="POST">
        <h2 style="margin-top: 0; color: #4b8ef1; text-align: center;">Contact Us</h2>
        <div style="margin-bottom: 15px;">
          <label for="name" style="display: block; margin-bottom: 5px; font-weight: 500;">Name:</label>
          <input type="text" id="name" name="name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="email" style="display: block; margin-bottom: 5px; font-weight: 500;">Email:</label>
          <input type="email" id="email" name="email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 20px;">
          <label for="message" style="display: block; margin-bottom: 5px; font-weight: 500;">Message:</label>
          <textarea id="message" name="message" rows="5" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; resize: vertical;"></textarea>
        </div>
        <div style="display: flex; justify-content: space-between;">
          <button type="button" id="cancel-contact-btn" style="padding: 10px 20px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button type="submit" style="padding: 10px 20px; background-color: #4b8ef1; color: white; border: none; border-radius: 4px; cursor: pointer;">Send Message</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/owl-carousel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.js') }}"></script>
  <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
  <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
  <script src="{{ url_for('static', filename='js/scripts_fixed.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const eventsRow = document.getElementById('eventsRow');
      const moreEventsBtn = document.getElementById('moreEventsBtn');
      const lessEventsBtn = document.getElementById('lessEventsBtn');
      const eventCards = document.querySelectorAll('.event-card');
      const eventModal = document.getElementById('eventModal');
      const modalClose = document.querySelector('#eventModal .modal-close');
      const modalImage = document.getElementById('modal-image');
      const modalTitle = document.getElementById('modal-title');
      const modalDescription = document.getElementById('modal-description');
      const modalOrganizer = document.getElementById('modal-organizer');
      const modalType = document.getElementById('modal-type');
      const modalDates = document.getElementById('modal-dates');
      const modalTime = document.getElementById('modal-time');
      const modalPlace = document.getElementById('modal-place');
      const initialDisplayCount = 16;
      let visibleCount = Math.min(initialDisplayCount, eventCards.length);

      // Function to update button states
      function updateButtonStates() {
        const visibleCards = Array.from(eventCards).filter(card => !card.classList.contains('d-none'));
        moreEventsBtn.disabled = visibleCards.length >= eventCards.length;
        lessEventsBtn.disabled = visibleCards.length <= initialDisplayCount;
      }

      // Initial button state
      updateButtonStates();

      // More button click handler
      moreEventsBtn.addEventListener('click', function() {
        const nextBatch = Array.from(eventCards)
          .filter(card => card.classList.contains('d-none'))
          .slice(0, initialDisplayCount);
        nextBatch.forEach(card => {
          card.classList.remove('d-none');
        });
        visibleCount = Math.min(visibleCount + nextBatch.length, eventCards.length);
        updateButtonStates();
      });

      // Less button click handler
      lessEventsBtn.addEventListener('click', function() {
        const excessCards = Array.from(eventCards).slice(initialDisplayCount);
        excessCards.forEach(card => {
          card.classList.add('d-none');
        });
        visibleCount = initialDisplayCount;
        updateButtonStates();
      });

      // Filter and Search functionality
      const eventInput = document.getElementById('event-input');
      const organizerFilter = document.getElementById('organizer-filter');
      const typeFilter = document.getElementById('type-filter');
      const placeFilter = document.getElementById('place-filter');
      const dateFilter = document.getElementById('date-filter');

      function applyFilters() {
        const searchValue = eventInput.value.toLowerCase().trim();
        const organizerValue = organizerFilter.value;
        const typeValue = typeFilter.value;
        const placeValue = placeFilter.value;
        const dateValue = dateFilter.value;

        eventCards.forEach((card, index) => {
          const title = card.querySelector('.event-title').textContent.toLowerCase();
          const organizer = card.dataset.organizer;
          const type = card.dataset.type;
          const place = card.dataset.place;
          const date = card.dataset.date;

          const matchesSearch = title.includes(searchValue);
          const matchesOrganizer = !organizerValue || organizer === organizerValue;
          const matchesType = !typeValue || type === typeValue;
          const matchesPlace = !placeValue || place === placeValue;
          const matchesDate = !dateValue || date === dateValue;

          const isVisible = matchesSearch && matchesOrganizer && matchesType && matchesPlace && matchesDate;
          card.classList.toggle('d-none', !isVisible || index >= visibleCount);
        });

        updateButtonStates();
      }

      eventInput.addEventListener('input', applyFilters);
      organizerFilter.addEventListener('change', applyFilters);
      typeFilter.addEventListener('change', applyFilters);
      placeFilter.addEventListener('change', applyFilters);
      dateFilter.addEventListener('change', applyFilters);

      // Learn More button and Modal handling
      const learnMoreButtons = document.querySelectorAll('.learn-more-btn');
      learnMoreButtons.forEach(button => {
        button.addEventListener('click', function() {
          modalImage.src = this.dataset.image;
          modalTitle.textContent = this.dataset.title;
          modalDescription.textContent = this.dataset.description;
          modalOrganizer.textContent = this.dataset.organizer;
          modalType.textContent = this.dataset.type;
          modalDates.textContent = this.dataset.dates;
          modalTime.textContent = this.dataset.time;
          modalPlace.textContent = this.dataset.place;
          eventModal.style.display = 'block';
        });
      });

      modalClose.addEventListener('click', function() {
        eventModal.style.display = 'none';
      });

      eventModal.addEventListener('click', function(e) {
        if (e.target === eventModal) {
          eventModal.style.display = 'none';
        }
      });

      
    });
  </script>
</body>
</html>