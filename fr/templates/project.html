<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="Projects at ENSIT Research Center" />
  <meta name="author" content="ENSIT Research Center" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

  <title>ENSIT Research Center - Projects</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-chain-app-dev.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animated.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}" />
  <style>
    .filter-group .btn-secondary {
      padding: 10px 15px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .filter-group .btn-secondary:hover {
      background: #5a6268;
    }
    .d-none {
      display: none !important;
    }

    .card-img-top {
      height: 200px;
      object-fit: cover;
      width: 100%;
    }

    .card {
      height: 100%;
      display: flex;
      flex-direction: column;
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .card-body {
      flex-grow: 1;
      padding: 20px;
    }

    .card-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 15px;
    }

    .card-text-manager {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.5rem;
    }

    .card-text {
      font-size: 0.95rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .btn-primary {
      background: #4b8ef1;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .btn-primary:hover {
      background: #3a7bd5;
    }

    #project-more-btn {
      padding: 12px 30px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 8px;
      background: #4b8ef1;
      color: #fff;
      border: none;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    #project-more-btn:hover {
      background: #3a7bd5;
      transform: translateY(-2px);
    }

    /* Filter Styling */
    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group .form-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-group label {
      font-weight: 500;
      margin-bottom: 5px;
      display: block;
    }

    .filter-group select,
    .filter-group input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.95rem;
    }

    /* Modal Styling */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal-content {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }

    .modal-content h2 {
      color: #4b8ef1;
      margin-top: 0;
      font-size: 1.8rem;
    }

    .modal-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .modal-details p {
      margin: 10px 0;
      font-size: 1rem;
      color: #555;
    }

    .modal-details strong margins {
      color: #333;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .card-img-top {
        height: 180px;
      }

      .card-title {
        font-size: 1.3rem;
      }

      .card {
        max-width: 100%;
      }

      .filter-group .form-group {
        min-width: 100%;
      }
    }

    @media (max-width: 576px) {
      .card-img-top {
        height: 160px;
      }

      .card-title {
        font-size: 1.2rem;
      }

      #project-more-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }

      .modal-image {
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- ***** Logo Start ***** -->
            <a href="{{ url_for('fr.index') }}" class="logo">
              <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ENSIT Research Center" />
            </a>
            <!-- ***** Logo End ***** -->
            <!-- ***** Menu Start ***** -->
            <ul class="nav">
              <li class="scroll-to-section"><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.project') }}" class="active">Project</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.staff') }}">Staff</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.about') }}">About Us</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.contact') }}" class="contact-btn">Contact</a></li>
            </ul>
            <a class="menu-trigger">
              <span>Menu</span>
            </a>
            <!-- ***** Menu End ***** -->
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <main style="padding-top: 150px; padding-bottom: 50px;">
    <h1 class="text-center mb-4">Our Projects</h1>
    <div class="container mt-4">
      <!-- Search Input -->
      <div class="mb-3">
        <label for="research-input" class="form-label">Search Projects:</label>
        <div class="input-group" style="max-width: 300px;">
          <span class="input-group-text" id="project-icon" style="background-color: white; border-right: none;">
            <i class="fas fa-project-diagram" style="color: #4b8ef1;"></i>
          </span>
          <input type="text" id="research-input" name="research" placeholder="Enter research topic" class="form-control" aria-label="Research input" aria-describedby="project-icon" style="border-left: none;" />
        </div>
      </div>
      <!-- Filter Section -->
      <div class="filter-group">
        <div class="form-group">
          <label for="filter-date-begin">Start Date:</label>
          <input type="date" id="filter-date-begin" class="form-control" />
        </div>
        <div class="form-group">
          <label for="filter-date-end">End Date:</label>
          <input type="date" id="filter-date-end" class="form-control" />
        </div>
        <div class="form-group">
          <label for="filter-state">State:</label>
          <select id="filter-state" class="form-control">
            <option value="">All States</option>
            {% for state in projects | map(attribute='STATE') | unique | sort %}
              <option value="{{ state }}">{{ state }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="filter-manager">Manager:</label>
          <select id="filter-manager" class="form-control">
            <option value="">All Managers</option>
            {% for manager in researchers %}
              <option value="{{ manager.FULL_NAME }}">{{ manager.FULL_NAME }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <!-- Project Cards -->
      {% if projects %}
      <div class="row" id="project-container">
        {% for project in projects %}
        <div class="col-md-6 col-lg-3 mb-4 initial-project {% if loop.index > 16 %}d-none{% endif %}" 
             data-date-begin="{{ project.DATE_BEGIN }}" 
             data-date-end="{{ project.DATE_END }}" 
             data-state="{{ project.STATE }}" 
             data-manager="{% for manager in researchers %}{% if manager.id == project.ID_MANAGER %}{{ manager.FULL_NAME }}{% endif %}{% endfor %}">
          <div class="card">
            {% set image_path = project.IMAGE if project.IMAGE else 'images/uploads/projects/default-project.jpg' %}
            {% set image_path = image_path[7:] if image_path.startswith('static/') else image_path %}
            <img src="{{ url_for('static', filename=image_path) }}" class="card-img-top" alt="{{ project.NAME_PROJECT }}">
            <div class="card-body">
              <h5 class="card-title">{{ project.NAME_PROJECT }}</h5>
              <p class="card-text-manager">
                Manager: {% for manager in researchers %}{% if manager.id == project.ID_MANAGER %}{{ manager.FULL_NAME }}{% endif %}{% endfor %}
              </p>
              <p class="card-text">{{ project.DESCRIPTION|default('No description available.', true) }}</p>
              <button class="btn btn-primary learn-more-btn"
                      data-title="{{ project.NAME_PROJECT }}"
                      data-image="{{ url_for('static', filename=image_path) }}"
                      data-description="{{ project.DESCRIPTION|default('No description available.', true) }}"
                      data-manager="{% for manager in researchers %}{% if manager.id == project.ID_MANAGER %}{{ manager.FULL_NAME }}{% endif %}{% endfor %}"
                      data-dates="{{ project.DATE_BEGIN if project.DATE_BEGIN else 'N/A' }} - {{ project.DATE_END if project.DATE_END else 'N/A' }}"
                      data-state="{{ project.STATE if project.STATE else 'N/A' }}">Learn More</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="alert alert-info mt-4">
        <i class="fas fa-info-circle me-2"></i>No projects found.
      </div>
      {% endif %}
      <!-- More Button -->
      <div class="text-center mt-3">
        <button type="button" id="project-more-btn" class="btn btn-secondary" {% if projects|length <= 16 %}style="display: none;"{% endif %}>More</button>
      </div>
    </div>
  </main>

  <!-- Project Details Modal -->
  <div id="detailsModal" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close">×</span>
      <img id="modal-image" class="modal-image" src="" alt="Project Image">
      <h2 id="modal-title"></h2>
      <div class="modal-details">
        <p><strong>Description:</strong> <span id="modal-description"></span></p>
        <p><strong>Manager:</strong> <span id="modal-manager"></span></p>
        <p><strong>Dates:</strong> <span id="modal-dates"></span></p>
        <p><strong>State:</strong> <span id="modal-state"></span></p>
      </div>
    </div>
  </div>

  <footer id="contact">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Contact Us</h4>
            <p>ENSIT Beb Alioua, Tunis</p>
            <p><a href="#">123456789</a></p>
            <p><a href="mailto:ensit@research.center">ensit@research.center</a></p>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Us</h4>
            <ul>
              <li><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="{{ url_for('fr.about') }}">About</a></li>
              <li><a href="#">Testimonials</a></li>
              <li><a href="#">Pricing</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Research</a></li>
              <li><a href="{{ url_for('fr.project') }}">Projects</a></li>
              <li><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li><a href="#">News</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Our Center</h4>
            <div class="logo">
              <img src="{{ url_for('static', filename='images/white-logo.png') }}" alt="" />
            </div>
            <p>ENSIT Research Center is dedicated to advancing knowledge and innovation through interdisciplinary research and collaboration.</p>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="copyright-text">
            <p>Copyright © 2023 ENSIT Research Center. All Rights Reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Contact Form Overlay -->
  <div id="form-overlay" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close">×</span>
      <form id="contact-form" action="{{ url_for('fr.contact') }}" method="POST">
        <h2 style="margin-top: 0; color: #4b8ef1; text-align: center;">Contact Us</h2>
        <div style="margin-bottom: 15px;">
          <label for="name" style="display: block; margin-bottom: 5px; font-weight: 500;">Name:</label>
          <input type="text" id="name" name="name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="email" style="display: block; margin-bottom: 5px; font-weight: 500;">Email:</label>
          <input type="email" id="email" name="email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 20px;">
          <label for="message" style="display: block; margin-bottom: 5px; font-weight: 500;">Message:</label>
          <textarea id="message" name="message" rows="5" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; resize: vertical;"></textarea>
        </div>
        <div style="display: flex; justify-content: space-between;">
          <button type="button" id="cancel-contact-btn" style="padding: 10px 20px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button type="submit" style="padding: 10px 20px; background-color: #4b8ef1; color: white; border: none; border-radius: 4px; cursor: pointer;">Send Message</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/owl-carousel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.js') }}"></script>
  <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
  <script src="{{ url_for('static', filename='js/custom.js') }}"></script>

 // Scripts
<script>
      document.addEventListener('DOMContentLoaded', function() {
        const projectContainer = document.getElementById('project-container');
        const moreBtn = document.getElementById('project-more-btn');
        const detailsModal = document.getElementById('detailsModal');
        const modalClose = document.querySelector('#detailsModal .modal-close');
        const modalImage = document.getElementById('modal-image');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalManager = document.getElementById('modal-manager');
        const modalDates = document.getElementById('modal-dates');
        const modalState = document.getElementById('modal-state');
        const initialDisplayCount = 16;
        let isExpanded = false;
        let isFilterActive = false; // Track if any filter is active
      
        // Filter and Search Functionality
        const researchInput = document.getElementById('research-input');
        const filterDateBegin = document.getElementById('filter-date-begin');
        const filterDateEnd = document.getElementById('filter-date-end');
        const filterState = document.getElementById('filter-state');
        const filterManager = document.getElementById('filter-manager');
      
        function checkIfFiltersActive() {
          return researchInput.value || 
                 filterDateBegin.value || 
                 filterDateEnd.value || 
                 filterState.value || 
                 filterManager.value;
        }
      
        function applyFilters() {
          const searchText = researchInput.value.toLowerCase().trim();
          const dateBegin = filterDateBegin.value;
          const dateEnd = filterDateEnd.value;
          const state = filterState.value;
          const manager = filterManager.value;
          
          isFilterActive = checkIfFiltersActive();
          
          const projectCards = document.querySelectorAll('.initial-project');
          let visibleProjects = 0;
      
          projectCards.forEach((card, index) => {
            const title = card.querySelector('.card-title').textContent.toLowerCase();
            const cardDateBegin = card.dataset.dateBegin;
            const cardDateEnd = card.dataset.dateEnd;
            const cardState = card.dataset.state;
            const cardManager = card.dataset.manager.toLowerCase();
      
            const matchesSearch = !searchText || title.includes(searchText);
            const matchesDateBegin = !dateBegin || cardDateBegin >= dateBegin;
            const matchesDateEnd = !dateEnd || cardDateEnd <= dateEnd;
            const matchesState = !state || cardState === state;
            const matchesManager = !manager || cardManager.includes(manager.toLowerCase());
      
            const isVisible = matchesSearch && matchesDateBegin && matchesDateEnd && matchesState && matchesManager;
            
            // Show all matching projects when filters are active
            // Otherwise, respect the initial display limit
            const shouldShow = isFilterActive ? isVisible : (isVisible && (isExpanded || index < initialDisplayCount));
            
            card.classList.toggle('d-none', !shouldShow);
            if (isVisible) visibleProjects++;
          });
      
          // Only show More button when no filters are active and there are more projects to show
          moreBtn.style.display = (!isFilterActive && visibleProjects > initialDisplayCount) ? 'block' : 'none';
          moreBtn.textContent = isExpanded ? 'Less' : 'More';
        }
      
        // Reset filters button (optional)
        function addResetFiltersButton() {
          const filterGroup = document.querySelector('.filter-group');
          const resetBtn = document.createElement('button');
          resetBtn.textContent = 'Reset Filters';
          resetBtn.className = 'btn btn-secondary';
          resetBtn.style.marginLeft = 'auto';
          resetBtn.style.alignSelf = 'flex-end';
          resetBtn.addEventListener('click', function() {
            researchInput.value = '';
            filterDateBegin.value = '';
            filterDateEnd.value = '';
            filterState.value = '';
            filterManager.value = '';
            isFilterActive = false;
            applyFilters();
          });
          filterGroup.appendChild(resetBtn);
        }
      
        // Initialize
        addResetFiltersButton();
        applyFilters();
      
        researchInput.addEventListener('input', applyFilters);
        filterDateBegin.addEventListener('change', applyFilters);
        filterDateEnd.addEventListener('change', applyFilters);
        filterState.addEventListener('change', applyFilters);
        filterManager.addEventListener('change', applyFilters);
      
        // More/Less Button Handler
        if (moreBtn) {
          moreBtn.addEventListener('click', function() {
            isExpanded = !isExpanded;
            applyFilters();
          });
        }
      
        // Learn More button and Modal handling
        const learnMoreButtons = document.querySelectorAll('.learn-more-btn');
        learnMoreButtons.forEach(button => {
          button.addEventListener('click', function() {
            modalImage.src = this.dataset.image;
            modalTitle.textContent = this.dataset.title;
            modalDescription.textContent = this.dataset.description;
            modalManager.textContent = this.dataset.manager;
            modalDates.textContent = this.dataset.dates;
            modalState.textContent = this.dataset.state;
            detailsModal.style.display = 'block';
          });
        });
      
        modalClose.addEventListener('click', function() {
          detailsModal.style.display = 'none';
        });
      
        detailsModal.addEventListener('click', function(e) {
          if (e.target === detailsModal) {
            detailsModal.style.display = 'none';
          }
        });
      
        // Contact Form Handling
        const contactFormOverlay = document.getElementById('form-overlay');
        const cancelContactBtn = document.getElementById('cancel-contact-btn');
        const closeBtn = document.querySelector('#form-overlay .modal-close');
        const contactButtons = document.querySelectorAll('.contact-btn');
      
        contactButtons.forEach(button => {
          button.addEventListener('click', function(e) {
            e.preventDefault();
            contactFormOverlay.style.display = 'block';
          });
        });
      
        function hideContactForm() {
          contactFormOverlay.style.display = 'none';
        }
      
        if (cancelContactBtn) {
          cancelContactBtn.addEventListener('click', hideContactForm);
        }
      
        if (closeBtn) {
          closeBtn.addEventListener('click', hideContactForm);
        }
      
        const contactForm = document.getElementById('contact-form');
        if (contactForm) {
          contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Thank you for your message! We will get back to you soon.');
            hideContactForm();
            contactForm.reset();
          });
        }
      });
</script>
</body>
</html>