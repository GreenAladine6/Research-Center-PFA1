<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="Publications at ENSIT Research Center" />
  <meta name="author" content="ENSIT Research Center" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

  <title>ENSIT Research Center - Publications</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-chain-app-dev.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animated.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pubs.css') }}" />

  <style>
    /* Ensure profile images are round and smaller */
    .card-header img.rounded-circle {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 50%;

      position: fixed;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.5); 
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-body img.rounded-circle {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 50%;
      
    }
    </style>
</head>
<body>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- ***** Logo Start ***** -->
            <a href="{{ url_for('fr.index') }}" class="logo">
              <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ENSIT Research Center" />
            </a>
            <!-- ***** Logo End ***** -->
            <!-- ***** Menu Start ***** -->
            <ul class="nav">
              <li class="scroll-to-section"><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.project') }}">Project</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.publications') }}">publications</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.about') }}">About Us</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.contact') }}">Contact</a></li>
            </ul>
            <a class="menu-trigger">
              <span>Menu</span>
            </a>
            <!-- ***** Menu End ***** -->
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <main style="padding-top: 150px; padding-bottom: 50px;">
    <h1 class="text-center mb-4">Publications</h1>
    <div class="container">
        <!-- Search Input -->
        <div class="search-container" style="max-width: 800px; margin: 0 auto;">
          <div style="flex-grow: 1;">
              <label for="publication-input">Search by Title:</label>
              <div class="search-group">
                  <span class="input-group-text">
                      <i class="fas fa-book"></i>
                  </span>
                  <input type="text" id="publication-input" 
                         placeholder="Enter publication title" 
                         class="form-control">
              </div>
          </div>
      </div>

        <!-- Publications Grid -->
        <div id="publicationsRow" class="row">
            {% for publication in publications %}
            {% set researcher = researchers|selectattr('id', 'equalto', publication.ID_RESEARCHER)|first %}
            <div class="col-md-4 mb-4 publication-card {% if loop.index > 16 %}d-none{% endif %}" 
                 data-publication-id="{{ publication.id }}"
                 data-title="{{ publication.TITLE|lower }}">
                <div class="card h-100">
                    <!-- Researcher Profile -->
                    <div class="card-header d-flex align-items-center">
                        <img src="{{ url_for('static', filename=researcher.IMAGE) if researcher.IMAGE else url_for('static', filename='images/uploads/publications/publications-placeholder.png') }}" 
                             alt="{{ researcher.FULL_NAME }}" class="rounded-circle me-3">
                        <div>
                            <h6 class="mb-0">{{ researcher.FULL_NAME }}</h6>
                            <small class="text-muted">{{ researcher.POSITION or 'Researcher' }}</small>
                        </div>
                    </div>
                    
                    <!-- Publication Content -->
                    <div class="card-body">
                        <small class="text-muted d-block mb-2">
                            {% if publication.DATE_OBJ %}
                                {{ publication.DATE_OBJ.strftime('%B %d, %Y') }}
                            {% else %}
                                Date not available
                            {% endif %}
                        </small>
                        <h5 class="card-title">{{ publication.TITLE }}</h5>
                        <p class="card-text">{{ publication.DESCRIPTION|default('No description available')|truncate(150) }}</p>
                        
                        {% if publication.IMAGE %}
                        <img src="{{ url_for('static', filename=publication.IMAGE) }}" 
                             alt="{{ publication.TITLE }}" class="img-fluid mb-3">
                        {% endif %}
                        
                        <button class="btn btn-primary view-details-btn" 
                                data-bs-toggle="modal" 
                                data-bs-target="#publicationModal"
                                data-title="{{ publication.TITLE }}"
                                data-researcher="{{ researcher.FULL_NAME }}"
                                data-position="{{ researcher.POSITION or 'Researcher' }}"
                                data-researcher-img="{{ url_for('static', filename=researcher.IMAGE) if researcher.IMAGE else url_for('static', filename='images/uploads/publications/publications-placeholder.png') }}"
                                data-image="{{ url_for('static', filename=publication.IMAGE) if publication.IMAGE else '' }}"
                                data-description="{{ publication.DESCRIPTION|default('No description available') }}"
                                data-link="{{ publication.LINK or '' }}"
                                data-date="{% if publication.DATE_OBJ %}{{ publication.DATE_OBJ.strftime('%B %d, %Y') }}{% else %}Date not available{% endif %}">
                            Learn More
                        </button>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12">
                <div class="alert alert-info">No publications found.</div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <button id="loadMoreBtn" class="btn btn-outline-primary">Load More</button>
            <button id="showLessBtn" class="btn btn-outline-secondary ms-2" disabled>Show Less</button>
        </div>
    </div>
</main>

<!-- Publication Details Modal -->
<div class="modal fade" id="publicationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center mb-4">
                    <img id="modalResearcherImg" src="" alt="Researcher" class="rounded-circle me-3">
                    <div>
                        <h6 id="modalResearcherName" class="mb-0"></h6>
                        <small id="modalResearcherPosition" class="text-muted"></small>
                        <div id="modalDate" class="text-muted small"></div>
                    </div>
                </div>
                
                <div id="modalImageContainer" class="mb-3 text-center">
                    <img id="modalImage" src="" alt="Publication Image" class="img-fluid" style="max-height: 400px; width: auto;">
                </div>
                
                <div class="mb-3">
                    <h6>Description</h6>
                    <p id="modalDescription" class="text-muted"></p>
                </div>
                
                <div id="modalLinkContainer">
                    <h6>Link</h6>
                    <a id="modalLink" href="#" target="_blank" class="text-decoration-none"></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

  <footer id="contact">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Contact Us</h4>
            <p>ENSIT Beb Alioua, Tunis</p>
            <p><a href="#">123456789</a></p>
            <p><a href="mailto:ensit@research.center">ensit@research.center</a></p>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Us</h4>
            <ul>
              <li><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="{{ url_for('fr.about') }}">About</a></li>
              <li><a href="#">Testimonials</a></li>
              <li><a href="#">Pricing</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Research</a></li>
              <li><a href="{{ url_for('fr.project') }}">Projects</a></li>
              <li><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li><a href="#">News</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Our Center</h4>
            <div class="logo">
              <img src="{{ url_for('static', filename='images/white-logo.png') }}" alt="" />
            </div>
            <p>ENSIT Research Center is dedicated to advancing knowledge and innovation through interdisciplinary research and collaboration.</p>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="copyright-text">
            <p>Copyright © 2023 ENSIT Research Center. All Rights Reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/owl-carousel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.js') }}"></script>
  <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
  <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Element references
      const publicationsRow = document.getElementById('publicationsRow');
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      const showLessBtn = document.getElementById('showLessBtn');
      const publicationCards = document.querySelectorAll('.publication-card');
      const publicationInput = document.getElementById('publication-input');
      const initialDisplayCount = 16;
      let visibleCount = Math.min(initialDisplayCount, publicationCards.length);

      // Function to update button states
      function updateButtonStates() {
        if (!loadMoreBtn || !showLessBtn) return;
        
        const hiddenCards = Array.from(publicationCards).filter(card => card.classList.contains('d-none')).length;
        const visibleCards = publicationCards.length - hiddenCards;
        
        loadMoreBtn.disabled = hiddenCards === 0;
        showLessBtn.disabled = visibleCards <= initialDisplayCount;
      }

      // Initial button state
      updateButtonStates();

      // Load More button click handler
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
          const nextBatch = Array.from(publicationCards)
            .filter(card => card.classList.contains('d-none'))
            .slice(0, initialDisplayCount);
          
          nextBatch.forEach(card => {
            card.classList.remove('d-none');
          });
          
          visibleCount = Math.min(visibleCount + nextBatch.length, publicationCards.length);
          updateButtonStates();
        });
      }

      // Show Less button click handler
      if (showLessBtn) {
        showLessBtn.addEventListener('click', function() {
          const allCards = Array.from(publicationCards);
          const cardsToHide = allCards.slice(initialDisplayCount);
          
          cardsToHide.forEach(card => {
            card.classList.add('d-none');
          });
          
          visibleCount = initialDisplayCount;
          updateButtonStates();
        });
      }

      // Search functionality
      if (publicationInput) {
        publicationInput.addEventListener('input', function() {
          const searchValue = this.value.toLowerCase().trim();
          
          publicationCards.forEach(card => {
            const title = card.dataset.title || '';
            const matchesSearch = title.includes(searchValue);
            
            if (matchesSearch) {
              card.classList.remove('d-none');
            } else {
              card.classList.add('d-none');
            }
          });
          
          updateButtonStates();
        });
      }

      // Publication Details Modal handling
      const viewDetailsButtons = document.querySelectorAll('.view-details-btn');
      viewDetailsButtons.forEach(button => {
        button.addEventListener('click', function() {
          const modal = new bootstrap.Modal(document.getElementById('publicationModal'));
          const modalTitle = document.getElementById('modalTitle');
          const modalResearcherImg = document.getElementById('modalResearcherImg');
          const modalResearcherName = document.getElementById('modalResearcherName');
          const modalResearcherPosition = document.getElementById('modalResearcherPosition');
          const modalImage = document.getElementById('modalImage');
          const modalDescription = document.getElementById('modalDescription');
          const modalLink = document.getElementById('modalLink');
          const modalDate = document.getElementById('modalDate');
          const modalLinkContainer = document.getElementById('modalLinkContainer');
          
          // Set modal content
          modalTitle.textContent = this.dataset.title;
          modalResearcherImg.src = this.dataset.researcherImg;
          modalResearcherImg.alt = this.dataset.researcher;
          modalResearcherName.textContent = this.dataset.researcher;
          modalResearcherPosition.textContent = this.dataset.position;
          modalDate.textContent = this.dataset.date;
          modalDescription.textContent = this.dataset.description;
          
          // Handle image
          if (this.dataset.image) {
            modalImage.src = this.dataset.image;
            modalImage.style.display = 'block';
          } else {
            modalImage.style.display = 'none';
          }
          
          // Handle link
          if (this.dataset.link) {
            modalLink.href = this.dataset.link;
            modalLink.textContent = this.dataset.link;
            modalLinkContainer.style.display = 'block';
          } else {
            modalLinkContainer.style.display = 'none';
          }
          
          modal.show();
        });
      });

      // Fix scrolling issue after modal close
      const publicationModal = document.getElementById('publicationModal');
      if (publicationModal) {
        publicationModal.addEventListener('hidden.bs.modal', function () {
          document.body.classList.remove('modal-open');
          document.body.style.overflow = '';
          document.body.style.paddingRight = '';
          const modals = document.querySelectorAll('.modal-backdrop');
          modals.forEach(modal => modal.remove());
        });
      }
    });
  </script>
</body>
</html>