<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="Publications at ENSIT Research Center" />
  <meta name="author" content="ENSIT Research Center" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

  <title>ENSIT Research Center - Publications</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/events.css') }}" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-chain-app-dev.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animated.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pubs.css') }}" />

</head>
<body>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- ***** Logo Start ***** -->
            <a href="{{ url_for('fr.index') }}" class="logo">
              <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ENSIT Research Center" />
            </a>
            <!-- ***** Logo End ***** -->
            <!-- ***** Menu Start ***** -->
            <ul class="nav">
              <li class="scroll-to-section"><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.project') }}">Project</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.publications') }}">publications</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.about') }}">About Us</a></li>
              <li class="scroll-to-section"><a href="{{ url_for('fr.contact') }}">Contact</a></li>
            </ul>
            <a class="menu-trigger">
              <span>Menu</span>
            </a>
            <!-- ***** Menu End ***** -->
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <main style="padding-top: 150px; padding-bottom: 50px;">
    <h1 class="text-center mb-4">Publications</h1>
    <div class="container">
        <!-- Search Input -->
        <div class="search-container" style="max-width: 800px;">
          <div style="flex-grow: 1;">
              <label for="publication-input">Search by Title:</label>
              <div class="search-group">
                  <span class="input-group-text">
                      <i class="fas fa-book"></i>
                  </span>
                  <input type="text" id="publication-input" 
                         placeholder="Enter publication title" 
                         class="form-control">
              </div>
          </div>
          
          <button id="addPublicationBtn" 
                  class="btn btn-success add-btn" 
                  data-bs-toggle="modal" 
                  data-bs-target="#addPublicationModal">
              Add Publication
          </button>
      </div>

        <!-- Publications Grid -->
        <div id="publicationsRow" class="row">
            {% for publication in publications %}
            {% set researcher = researchers|selectattr('id', 'equalto', publication.ID_RESEARCHER)|first %}
            <div class="col-md-4 mb-4 publication-card {% if loop.index > 16 %}d-none{% endif %}" 
                 data-publication-id="{{ publication.id }}"
                 data-title="{{ publication.TITLE|lower }}">
                <div class="card h-100">
                    <!-- Researcher Profile -->
                    <div class="card-header d-flex align-items-center">
                        <img src="{{ url_for('static', filename=researcher.IMAGE) if researcher.IMAGE else url_for('static', filename='images/avatar-placeholder.png') }}" 
                             alt="{{ researcher.FULL_NAME }}" class="rounded-circle me-3" width="50" height="50">
                        <div>
                            <h6 class="mb-0">{{ researcher.FULL_NAME }}</h6>
                            <small class="text-muted">{{ researcher.POSITION or 'Researcher' }}</small>
                        </div>
                    </div>
                    
                    <!-- Publication Content -->
                    <div class="card-body">
                        <small class="text-muted d-block mb-2">
                            {% if publication.DATE_OBJ %}
                                {{ publication.DATE_OBJ.strftime('%B %d, %Y') }}
                            {% else %}
                                Date not available
                            {% endif %}
                        </small>
                        <h5 class="card-title">{{ publication.TITLE }}</h5>
                        <p class="card-text">{{ publication.DESCRIPTION|default('No description available')|truncate(150) }}</p>
                        
                        {% if publication.IMAGE %}
                        <img src="{{ url_for('static', filename=publication.IMAGE) }}" 
                             alt="{{ publication.TITLE }}" class="img-fluid mb-3">
                        {% endif %}
                        
                        <button class="btn btn-primary view-details-btn" 
                                data-bs-toggle="modal" 
                                data-bs-target="#publicationModal"
                                data-title="{{ publication.TITLE }}"
                                data-researcher="{{ researcher.FULL_NAME }}"
                                data-position="{{ researcher.POSITION or 'Researcher' }}"
                                data-researcher-img="{{ url_for('static', filename=researcher.IMAGE) if researcher.IMAGE else url_for('static', filename='images/avatar-placeholder.png') }}"
                                data-image="{{ url_for('static', filename=publication.IMAGE) if publication.IMAGE else '' }}"
                                data-description="{{ publication.DESCRIPTION|default('No description available') }}"
                                data-link="{{ publication.LINK or '' }}"
                                data-date="{% if publication.DATE_OBJ %}{{ publication.DATE_OBJ.strftime('%B %d, %Y') }}{% else %}Date not available{% endif %}">
                            View Details
                        </button>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12">
                <div class="alert alert-info">No publications found.</div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <button id="loadMoreBtn" class="btn btn-outline-primary">Load More</button>
            <button id="showLessBtn" class="btn btn-outline-secondary ms-2" disabled>Show Less</button>
        </div>
    </div>
</main>

<!-- Publication Details Modal -->
<div class="modal fade" id="publicationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center mb-4">
                    <img id="modalResearcherImg" src="" alt="Researcher" class="rounded-circle me-3" width="60" height="60">
                    <div>
                        <h6 id="modalResearcherName" class="mb-0"></h6>
                        <small id="modalResearcherPosition" class="text-muted"></small>
                        <div id="modalDate" class="text-muted small"></div>
                    </div>
                </div>
                
                <div id="modalImageContainer" class="mb-3 text-center">
                    <img id="modalImage" src="" alt="Publication Image" class="img-fluid" style="display: none;">
                </div>
                
                <div class="mb-3">
                    <h6>Description</h6>
                    <p id="modalDescription" class="text-muted"></p>
                </div>
                
                <div id="modalLinkContainer" style="display: none;">
                    <h6>Link</h6>
                    <a id="modalLink" href="#" target="_blank" class="text-decoration-none"></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Publication Modal -->
<div class="modal fade" id="addPublicationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Add New Publication</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="addPublicationForm" enctype="multipart/form-data">
              <div class="modal-body">
                  <div class="mb-3">
                      <label class="form-label">Researcher ID and Full Name</label>
                      <input type="text" name="researcher_info" id="researcherInfo" class="form-control" 
                             placeholder="Enter researcher ID and full name (e.g., 123 - John Doe)" required>
                      <div id="researcherValidation" class="mt-2" style="display: none;">
                          <span id="validResearcher" class="text-success" style="display: none;">
                              <i class="fas fa-check-circle"></i> Valid researcher
                          </span>
                          <span id="invalidResearcher" class="text-danger" style="display: none;">
                              <i class="fas fa-times-circle"></i> Researcher not found
                          </span>
                      </div>
                  </div>
                  <div class="mb-3">
                      <label class="form-label">Title</label>
                      <input type="text" name="title" class="form-control" required>
                  </div>
                  <div class="mb-3">
                      <label class="form-label">Publication Date</label>
                      <input type="date" name="DATE_PUB" class="form-control">
                  </div>
                  <div class="mb-3">
                      <label class="form-label">Description</label>
                      <textarea name="description" rows="4" class="form-control" required></textarea>
                  </div>
                  <div class="mb-3">
                      <label class="form-label">Link (URL)</label>
                      <input type="url" name="link" class="form-control">
                  </div>
                  <div class="mb-3">
                      <label class="form-label">Image</label>
                      <input type="file" name="image" class="form-control" accept="image/*">
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" id="submitPublicationBtn" disabled>Save Publication</button>
              </div>
          </form>
      </div>
  </div>
</div>
 

  <footer id="contact">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Contact Us</h4>
            <p>ENSIT Beb Alioua, Tunis</p>
            <p><a href="#">123456789</a></p>
            <p><a href="mailto:ensit@research.center">ensit@research.center</a></p>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Us</h4>
            <ul>
              <li><a href="{{ url_for('fr.index') }}">Home</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="{{ url_for('fr.about') }}">About</a></li>
              <li><a href="#">Testimonials</a></li>
              <li><a href="#">Pricing</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Research</a></li>
              <li><a href="{{ url_for('fr.project') }}">Projects</a></li>
              <li><a href="{{ url_for('fr.publications') }}">Publications</a></li>
              <li><a href="{{ url_for('fr.events') }}">Events</a></li>
              <li><a href="#">News</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="footer-widget">
            <h4>About Our Center</h4>
            <div class="logo">
              <img src="{{ url_for('static', filename='images/white-logo.png') }}" alt="" />
            </div>
            <p>ENSIT Research Center is dedicated to advancing knowledge and innovation through interdisciplinary research and collaboration.</p>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="copyright-text">
            <p>Copyright © 2023 ENSIT Research Center. All Rights Reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/owl-carousel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.js') }}"></script>
  <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
  <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Element references
      const publicationsRow = document.getElementById('publicationsRow');
      const morePublicationsBtn = document.getElementById('morePublicationsBtn');
      const lessPublicationsBtn = document.getElementById('lessPublicationsBtn');
      const addPublicationBtn = document.getElementById('addPublicationBtn');
      const publicationCards = document.querySelectorAll('.publication-card');
      const detailsModal = document.getElementById('detailsModal');
      const modalClose = document.querySelector('#detailsModal .modal-close');
      const modalResearcherImage = document.getElementById('modal-researcher-image');
      const modalResearcherName = document.getElementById('modal-researcher-name');
      const modalResearcherPosition = document.getElementById('modal-researcher-position');
      const modalImage = document.getElementById('modal-image');
      const modalTitle = document.getElementById('modal-title');
      const modalDate = document.getElementById('modal-date');
      const modalDescription = document.getElementById('modal-description');
      const modalLink = document.getElementById('modal-link');
      const publicationInput = document.getElementById('publication-input');
      const addPublicationModal = document.getElementById('addPublicationModal');
      const addModalClose = document.querySelector('#addPublicationModal .modal-close');
      const contactFormOverlay = document.getElementById('form-overlay');
      const cancelContactBtn = document.getElementById('cancel-contact-btn');
      const contactCloseBtn = document.querySelector('#form-overlay .modal-close');
      const contactButtons = document.querySelectorAll('.contact-btn');
      const initialDisplayCount = 16;
      let visibleCount = Math.min(initialDisplayCount, publicationCards.length);

      // Function to update button states
      function updateButtonStates() {
        if (!morePublicationsBtn || !lessPublicationsBtn) return;
        const visibleCards = Array.from(publicationCards).filter(card => !card.classList.contains('d-none'));
        morePublicationsBtn.disabled = visibleCards.length >= publicationCards.length;
        lessPublicationsBtn.disabled = visibleCards.length <= initialDisplayCount;
      }

      // Initial button state
      updateButtonStates();

      // More button click handler
      if (morePublicationsBtn) {
        morePublicationsBtn.addEventListener('click', function() {
          const nextBatch = Array.from(publicationCards)
            .filter(card => card.classList.contains('d-none'))
            .slice(0, initialDisplayCount);
          nextBatch.forEach(card => {
            card.classList.remove('d-none');
          });
          visibleCount = Math.min(visibleCount + nextBatch.length, publicationCards.length);
          updateButtonStates();
        });
      }

      // Less button click handler
      if (lessPublicationsBtn) {
        lessPublicationsBtn.addEventListener('click', function() {
          const excessCards = Array.from(publicationCards).slice(initialDisplayCount);
          excessCards.forEach(card => {
            card.classList.add('d-none');
          });
          visibleCount = initialDisplayCount;
          updateButtonStates();
        });
      }

      // Search functionality
      if (publicationInput) {
        publicationInput.addEventListener('input', function() {
          const searchValue = this.value.toLowerCase().trim();
          publicationCards.forEach((card, index) => {
            const title = card.dataset.title ? card.dataset.title.toLowerCase() : '';
            const matchesSearch = title.includes(searchValue);
            card.classList.toggle('d-none', !matchesSearch || index >= visibleCount);
          });
          updateButtonStates();
        });
      }

      // Learn More button and Details Modal handling
      const learnMoreButtons = document.querySelectorAll('.learn-more-btn');
      learnMoreButtons.forEach(button => {
        button.addEventListener('click', function() {
          if (!detailsModal) return;
          modalResearcherImage.src = this.dataset.researcherImage || '';
          modalResearcherName.textContent = this.dataset.researcherName || 'Unknown';
          modalResearcherPosition.textContent = this.dataset.researcherPosition || 'Researcher';
          modalTitle.textContent = this.dataset.title || 'Unknown';
          modalDate.textContent = this.dataset.date || '';
          modalImage.src = this.dataset.image || '';
          modalImage.style.display = this.dataset.image ? 'block' : 'none';
          modalDescription.textContent = this.dataset.description || 'No description available';
          modalLink.innerHTML = this.dataset.link ? `<a href="${this.dataset.link}" target="_blank">${this.dataset.link}</a>` : 'No link available';
          detailsModal.style.display = 'block';
        });
      });

      if (modalClose) {
        modalClose.addEventListener('click', function() {
          if (detailsModal) detailsModal.style.display = 'none';
        });
      }

      if (detailsModal) {
        detailsModal.addEventListener('click', function(e) {
          if (e.target === detailsModal) {
            detailsModal.style.display = 'none';
          }
        });
      }

      // Add Publication Modal handling
      if (addPublicationBtn) {
        addPublicationBtn.addEventListener('click', function() {
          if (addPublicationModal) addPublicationModal.style.display = 'block';
        });
      }

      if (addModalClose) {
        addModalClose.addEventListener('click', function() {
          if (addPublicationModal) addPublicationModal.style.display = 'none';
        });
      }

      if (addPublicationModal) {
        addPublicationModal.addEventListener('click', function(e) {
          if (e.target === addPublicationModal) {
            addPublicationModal.style.display = 'none';
          }
        });
      }

      // Add Publication Form handling
      const addPublicationForm = document.getElementById('addPublicationForm');
      if (addPublicationForm) {
        addPublicationForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          fetch(this.action, {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const newPublicationId = data.id || 'new-' + Date.now();
              const researcherSelect = document.getElementById('researcherId');
              const researcherName = researcherSelect.options[researcherSelect.selectedIndex].text;
              const publicationDate = new Date(formData.get('DATE_PUB')).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              });
              const newPublication = `
                <div class="col-md-4 mb-4 publication-card" data-publication-id="${newPublicationId}" data-title="${formData.get('title')}">
                  <div class="publication-card">
                    <div class="publication-header">
                      <img src="{{ url_for('static', filename='images/uploads/pubs/pubs-placeholder.png') }}" alt="${researcherName}" class="researcher-photo">
                      <div class="researcher-info">
                        <p class="researcher-name">${researcherName}</p>
                        <p class="researcher-position">Researcher</p>
                      </div>
                    </div>
                    <div class="publication-content">
                      <p class="publication-date">${publicationDate}</p>
                      <h3 class="publication-title">${formData.get('title')}</h3>
                      <p class="publication-description">${formData.get('description').substring(0, 150)}${formData.get('description').length > 150 ? '...' : ''}</p>
                      <button class="btn btn-primary learn-more-btn" 
                              data-title="${formData.get('title')}"
                              data-researcher-name="${researcherName}"
                              data-researcher-position="Researcher"
                              data-researcher-image="{{ url_for('static', filename='images/uploads/pubs/pubs-placeholder.png') }}"
                              data-image=""
                              data-description="${ Grassland.get('description')}"
                              data-link="${formData.get('link') || ''}"
                              data-date="${publicationDate}">Learn More</button>
                    </div>
                  </div>
                </div>
              `;
              publicationsRow.insertAdjacentHTML('beforeend', newPublication);
              const newCard = publicationsRow.querySelector(`[data-publication-id="${newPublicationId}"]`);
              if (newCard && visibleCount < initialDisplayCount) {
                newCard.classList.remove('d-none');
                visibleCount++;
              }
              addPublicationForm.reset();
              addPublicationModal.style.display = 'none';
              alert('Publication added successfully!');
              // Update event listeners for new Learn More button
              const newLearnMoreBtn = newCard.querySelector('.learn-more-btn');
              newLearnMoreBtn.addEventListener('click', function() {
                modalResearcherImage.src = this.dataset.researcherImage;
                modalResearcherName.textContent = this.dataset.researcherName;
                modalResearcherPosition.textContent = this.dataset.researcherPosition;
                modalTitle.textContent = this.dataset.title;
                modalDate.textContent = this.dataset.date;
                modalImage.src = this.dataset.image;
                modalImage.style.display = this.dataset.image ? 'block' : 'none';
                modalDescription.textContent = this.dataset.description;
                modalLink.innerHTML = this.dataset.link ? `<a href="${this.dataset.link}" target="_blank">${this.dataset.link}</a>` : 'No link available';
                detailsModal.style.display = 'block';
              });
              updateButtonStates();
            } else {
              alert('Error adding publication: ' + (data.message || 'Unknown error'));
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while adding the publication.');
          });
        });
      }

      // Contact Form Handling
      contactButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          if (contactFormOverlay) contactFormOverlay.style.display = 'block';
        });
      });

      function hideContactForm() {
        if (contactFormOverlay) contactFormOverlay.style.display = 'none';
      }

      if (cancelContactBtn) {
        cancelContactBtn.addEventListener('click', hideContactForm);
      }

      if (contactCloseBtn) {
        contactCloseBtn.addEventListener('click', hideContactForm);
      }

      const contactForm = document.getElementById('contact-form');
      if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
          e.preventDefault();
          alert('Thank you for your message! We will get back to you soon.');
          hideContactForm();
          contactForm.reset();
        });
      }

      if (contactFormOverlay) {
        contactFormOverlay.addEventListener('click', function(e) {
          if (e.target === contactFormOverlay) {
            hideContactForm();
          }
        });
      }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Researcher validation
        const researcherInfo = document.getElementById('researcherInfo');
        const researcherValidation = document.getElementById('researcherValidation');
        const validResearcher = document.getElementById('validResearcher');
        const invalidResearcher = document.getElementById('invalidResearcher');
        const submitPublicationBtn = document.getElementById('submitPublicationBtn');
        
        // Debounce function to limit API calls
        function debounce(func, timeout = 500) {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }
        
        // Validate researcher when input changes
        researcherInfo.addEventListener('input', debounce(function() {
            const input = researcherInfo.value.trim();
            // Expected format: "ID - Full Name" (e.g., "123 - John Doe")
            const match = input.match(/^(\d+)\s*-\s*(.+)$/);
            
            if (!match) {
                researcherValidation.style.display = 'none';
                submitPublicationBtn.disabled = true;
                return;
            }
            
            const researcherId = match[1];
            const researcherName = match[2];
            
            // Call API to validate researcher
            fetch(`/api/validate-researcher?id=${researcherId}&name=${encodeURIComponent(researcherName)}`)
                .then(response => response.json())
                .then(data => {
                    researcherValidation.style.display = 'block';
                    
                    if (data.exists) {
                        validResearcher.style.display = 'inline';
                        invalidResearcher.style.display = 'none';
                        submitPublicationBtn.disabled = false;
                    } else {
                        validResearcher.style.display = 'none';
                        invalidResearcher.style.display = 'inline';
                        submitPublicationBtn.disabled = true;
                    }
                })
                .catch(error => {
                    console.error('Error validating researcher:', error);
                    researcherValidation.style.display = 'none';
                    submitPublicationBtn.disabled = true;
                });
        }));
        
        // Form submission
        const addForm = document.getElementById('addPublicationForm');
        if (addForm) {
            addForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get researcher ID from input
                const input = researcherInfo.value.trim();
                const match = input.match(/^(\d+)\s*-\s*(.+)$/);
                if (!match) {
                    alert('Please enter a valid researcher ID and name (format: "ID - Full Name")');
                    return;
                }
                
                const formData = new FormData(this);
                // Replace the researcher_info with just the ID
                formData.set('researcher_id', match[1]);
                
                fetch("{{ url_for('fr.add_publication') }}", {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Publication added successfully!');
                        window.location.reload();
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while adding the publication.');
                });
            });
        }
    });
    </script>
</body>
</html>